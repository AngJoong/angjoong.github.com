---
layout: post
title:  "Multi Thread Programming"
date:   2016-12-02 19:00:00 +0000
description:
tags: ['Thread', 'OS']
author: "AngJoong"
---

# 1. Overview
스레드는 CPU 이용의 기본 단위이다. 스레드 ID, 프로그램 카운터, 레지스터 집합, 그리고 스택으로 구성된다.  

<br/>
&lt;단일 및 다중 스레드 프로세스>  
<img  class="aligncenter" src="http://postfiles11.naver.net/20150417_202/three_letter_1429254488468egL0u_JPEG/4_01_ThreadDiagram.jpg?type=w2">
<br/>
<br/>
  
## 1.1 동기
웹 서버가 전통적인 단일 스레드 프로세스로 작동한다면, 자신의 단일 프로세스로 **한 번에 하나의 클라이언트만 서비스할 수 있게 되어** 클라이언트는 자신의 요구가 서비스되기까지 매우 긴 시간을 기다려야 한다.  

하나의 해결책은 서버에게 요청이 들어오면, 프로세스는 그 요청을 실행할 별도의 프로세스를 생성하는 것이다. 하지만 새 프로세스가 해야 할 일이 기존 프로세스와 동일한데 프로세스 생성 오버헤드를 감수할 필요가 없다.  

대부분의 경우 **프로세스 안에 여러 스레드를 만들어 나가는 것이 더 효율 적이다.**  

<br/>
&lt;다중 스레드화 된 서버 구조 - 요청 수신과 처리 스레드 분리>
<img class="aligncenter" src="http://postfiles15.naver.net/20150417_286/three_letter_142925454398959i6U_JPEG/4_02_MultithreadedArchitecture.jpg?type=w2">
<br/>
<br/>

## 1.2 장점
1. 응답성 (responsiveness): 응용 프로그램의 일부분이 봉쇄되거나, 응용 프로그램이 긴 작업을 실행하더라도 **프로그램의 실행이 계속되는 것을 허용함** 으로써 사용자에 대한 응답성을 증가시킨다.  

2. 자원 공유 (resource sharing): 프로세스는 공유 메모리 또는 메시지 전달 기법을 통해서만 자원을 공유할 수 있다. 그러나 **스레드는 자동적으로 그들이 속한 프로세스의 자원들과 메모리를 공유한다.**  

3. 경제성 (economy): 프로세스 생성을 위해 메모리와 자원을 할당하는 것은 비용이 많이 든다. **스레드는 자신이 속한 프로세스의 자원들을 공유하기 때문에 스레드를 생성하고 문맥을 교환하는 것이 보다 더 경제적이다.**

4. 규모 가변성 (scalability): **다중처리기 구조에서는 각각의 스레드가 다른 처리기에서 병렬로 실행될 수 있기 때문이다.**  

## 1.3 다중 코어 프로그래밍
다중 스레드 프로그래밍은 다중 코어를 더 효율적으로 사용할 수 있고 병행성을 더 향상시킬 수 있는 기법을 제공한다.  

하나의 코어는 한번에 오직 하나의 스레드만 실행할 수 있기 때문에 코어가 한 개인 시스템 상에서 병행성은 단순히 스레드의 실행이 시간에 따라 교대로 실행된다는 것을 의미한다.  

<br/>
&lt;단일 코어 시스템에서의 병행 실행>  
<img class="aligncenter" src="http://postfiles16.naver.net/20150417_95/three_letter_1429254600113YiEFV_JPEG/4_03_ConcurrentSingleCore.jpg?type=w2">
<br/>
<br/>

그러나, 여러 코어를 가진 시스템에서는 시스템이 개별 스레드를 각 콕어에 배정할 수 있기 때문에 병행성은 스레드들이 병렬적으로 실행될 수 있다는 것을 뜻한다.  

<br/>
&lt;다중 코어 시스템에서의 병행 실행>  
<img class="aligncenter" src="http://postfiles3.naver.net/20150417_290/three_letter_1429254600234Mjt6D_JPEG/4_04_ParralelMulticore.jpg?type=w2">
<br/>
<br/>

일반적으로 다중코어 시스템 상에서 프로그래밍을 하기 위해서는 5개의 극복해야 할 도전 과제가 있다.  

1. 작업 나누기 (dividing activities): 각 태스크가 개별 코어 상에서 병렬적으로 실행될 수 있도록 응용을 독립된 태스크로 나누는 작업  

2. 균형 (balance): 각 태스크가 전체 작업에 균등한 기여도를 가지도록 나누는것  

3. 데이터 분리 (data spliting): 태스크가 접근하고 조작하는 데이터 또한 개별 코어에서 사용할 수 있도록 나눈다  

4. 데이터 종속성 (data dependency): 둘 이상의 태스크 사이에 종속성이 없는지 검토해야 한다. 데이터가 종속적인 경우 적절한 동기화가 필요하다.  

5. 시험 및 디버깅 (testing and debugging): 단일 스레드에서 시험하고 디버깅하는것 보다 어렵다.  
